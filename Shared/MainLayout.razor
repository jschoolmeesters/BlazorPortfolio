@inherits LayoutComponentBase
@inject NavigationManager NavigationManager
@using Components
@using System.Text.Json

<main>
    <div class="wrapper w-full max-w-[500px] mx-auto">
        <div class="z-[1000] fixed top-0 w-full max-w-[500px] text-[hsla(26,28%,95%,.9)] bg-none select-none">
            <div class="z-[1000] flex items-center pt-8 pb-4 px-4">
                @if (ShowMenu || NavigationManager.Uri.Contains("blog")) {
                    <span @onclick="@(() => NavigateToPage(""))" class="cursor-pointer text-sm">Jordy Schoolmeesters</span>
                } else {
                    <span @onclick="@(() => NavigateToPage(""))" class="cursor-pointer  text-sm">DSP, Sound, Music production</span>
                }
                <span class="grow"></span>
                <button class="text-sm" @onclick="@(() => ShowMenu = !ShowMenu)">@(ShowMenu ? "CLOSE [×]" : "MENU [=]")</button>
            </div>
        </div>

        <aside class="opacity-fade text-[hsla(26,28%,95%,.7)] bg-[#141612] wrapper max-w-[500px] mx-auto fixed inset-0 overflow-hidden z-[999] @(ShowMenu ? "" : "hidden")" style="translate: none; rotate: none; scale: none; transform: translate(0px, 0px);">
        <nav class="flex absolute inset-0" style="translate: none; rotate: none; scale: none; transform: translate(0px, 0px);">
            <div class="flex flex-col justify-end w-full">
                <div></div>
                <ul class="p-4 flex flex-col items-start">
                    <li class="overflow-hidden">
                        <NavLink href="/" @onclick="@(() => ShowMenu = false)" Match="NavLinkMatch.All" class="nav-link flex text-6xl text-60 uppercase font-normal leading-[1.05]" style="translate: none; rotate: none; scale: none; transform: translate(0px, 0px);">
                            <span class="text-slideup animation-delay-0">Index</span>
                        </NavLink>
                    </li>
                    <li class="overflow-hidden">
                        <NavLink href="/blog" @onclick="@(() => ShowMenu = false)" class="nav-link flex text-6xl text-60 uppercase font-normal leading-[1.05]" style="translate: none; rotate: none; scale: none; transform: translate(0px, 0px);">
                            <span class="text-slideup animation-delay-1">Blog<span class="text-3xl align-top">[@PostCount]</span></span>
                        </NavLink>
                    </li>
                    <li class="overflow-hidden">
                    <NavLink class="nav-link disabled flex text-6xl text-60 uppercase font-normal leading-[1.05]" style="translate: none; rotate: none; scale: none; transform: translate(0px, 0px);">
                        <span class="text-slideup animation-delay-2 line-through">Services</span>
                    </NavLink>
                    </li>
                    <li class="overflow-hidden">
                    <NavLink class="nav-link disabled flex text-6xl text-60 uppercase font-normal leading-[1.05]" style="translate: none; rotate: none; scale: none; transform: translate(0px, 0px);">
                        <span class="text-slideup animation-delay-3 line-through">About</span>
                    </NavLink>
                    </li>
                    <li class="overflow-hidden">
                    <NavLink class="nav-link disabled flex text-6xl text-60 uppercase font-normal leading-[1.05]" style="translate: none; rotate: none; scale: none; transform: translate(0px, 0px);">
                        <span class="text-slideup animation-delay-4 line-through">Contact</span>
                    </NavLink>
                    </li>
                </ul>
            <BlazorPortfolio.Components.Footer />
            </div>
            
        </nav>
        </aside>


        <div>
            @Body
        </div>

    </div>
</main>


@code {
   [Inject]
   private HttpClient HttpClient { get; set; }
    private bool ShowMenu { get; set; } = false;
    private int PostCount { get; set; } = 0;

    private void NavigateToPage(string page) {
        var uri = Path.Combine(NavigationManager.BaseUri, page);

        if (!(uri == NavigationManager.Uri))
            NavigationManager.NavigateTo(uri);
            
        ShowMenu = false;
    }

   protected override async Task OnInitializedAsync()
   {
        var jsonContent = await HttpClient.GetStringAsync("posts/posts.json");
        var posts = JsonSerializer.Deserialize<List<Models.Post>>(jsonContent);
        if (posts != null)
                PostCount = posts.Count;
   }
}