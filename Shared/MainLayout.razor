@inherits LayoutComponentBase
@inject NavigationManager NavigationManager
@using Components
@using System.Text.Json

<main>
    <div class="wrapper w-full max-w-[500px] mx-auto">
        <div class="z-[1000] fixed top-0 w-full max-w-[500px] text-[#f6f2ef] bg-none select-none">
            @*<div id="navbar" class="@((ShowMenu || NavigationManager.Uri.Contains("blog")) ? "navbar-bg" : "") z-[1050] absolute inset-0 h-0 w-full bg-[#141612] content-[''] transition-all duration-300"></div>*@
            <div class="relative z-[1100] flex items-center p-4">
                @*@if (ShowMenu || NavigationManager.Uri.Contains("blog")) {
                    <span @onclick="@(() => NavigateToPage(""))" class="cursor-pointer text-sm">Jordy Schoolmeesters</span>
                } else {
                    <span @onclick="@(() => NavigateToPage(""))" class="cursor-pointer  text-sm">DSP, Sound, Music production</span>
                }*@
                <span class="grow"></span>
                @*<button class="text-sm" @onclick="@(() => ShowMenu = !ShowMenu)">@(ShowMenu ? "CLOSE [×]" : "MENU [=]")</button>*@
                <button class="w-[2.6rem] h-[2.6rem] bg-[#f6f2ef] content-['']" @onclick="@(() => ShowMenu = !ShowMenu)"></button>
            </div>
        </div>

        <aside class="opacity-fade text-[hsla(26,28%,95%,.7)] bg-[#141612] wrapper max-w-[500px] mx-auto fixed inset-0 overflow-hidden z-[999] @(ShowMenu ? "" : "hidden")" style="translate: none; rotate: none; scale: none; transform: translate(0px, 0px);">
            <nav class="flex absolute inset-0" style="translate: none; rotate: none; scale: none; transform: translate(0px, 0px);">
                <div class="flex flex-col justify-end w-full">
                    <div></div>
                    <ul class="p-4 flex flex-col items-start">
                        <li class="overflow-hidden">
                            <NavLink href="/" @onclick="@(() => ShowMenu = false)" Match="NavLinkMatch.All" class="nav-link flex text-6xl text-60 uppercase font-normal leading-[1.05]" style="translate: none; rotate: none; scale: none; transform: translate(0px, 0px);">
                                <span class="text-slideup animation-delay-0">Index</span>
                            </NavLink>
                        </li>
                        <li class="overflow-hidden">
                            <NavLink href="/blog" @onclick="@(() => ShowMenu = false)" class="nav-link flex text-6xl text-60 uppercase font-normal leading-[1.05]" style="translate: none; rotate: none; scale: none; transform: translate(0px, 0px);">
                                <span class="text-slideup animation-delay-1">Blog<span class="text-3xl align-top">[@PostCount]</span></span>
                            </NavLink>
                        </li>
                        <li class="overflow-hidden">
                        <NavLink class="nav-link disabled flex text-6xl text-60 uppercase font-normal leading-[1.05]" style="translate: none; rotate: none; scale: none; transform: translate(0px, 0px);">
                            <span class="text-slideup animation-delay-2 line-through">Services</span>
                        </NavLink>
                        </li>
                        <li class="overflow-hidden">
                        <NavLink class="nav-link disabled flex text-6xl text-60 uppercase font-normal leading-[1.05]" style="translate: none; rotate: none; scale: none; transform: translate(0px, 0px);">
                            <span class="text-slideup animation-delay-3 line-through">About</span>
                        </NavLink>
                        </li>
                        <li class="overflow-hidden">
                        <NavLink class="nav-link disabled flex text-6xl text-60 uppercase font-normal leading-[1.05]" style="translate: none; rotate: none; scale: none; transform: translate(0px, 0px);">
                            <span class="text-slideup animation-delay-4 line-through">Contact</span>
                        </NavLink>
                        </li>
                    </ul>
                <BlazorPortfolio.Components.Footer />
                </div>
            </nav>
        </aside>

        <div>
            @Body
        </div>

    </div>
</main>


@code {
   [Inject]
   private HttpClient HttpClient { get; set; }
    private bool ShowMenu { get; set; } = false;
    private int PostCount { get; set; } = 0;

    private void NavigateToPage(string page) {
        var uri = Path.Combine(NavigationManager.BaseUri, page);

        if (!(uri == NavigationManager.Uri))
            NavigationManager.NavigateTo(uri);
            
        ShowMenu = false;
    }

   protected override async Task OnInitializedAsync()
   {
        var jsonContent = await HttpClient.GetStringAsync("posts/posts.json");
        var posts = JsonSerializer.Deserialize<List<Models.Post>>(jsonContent);
        if (posts != null)
                PostCount = posts.Count;
   }
}